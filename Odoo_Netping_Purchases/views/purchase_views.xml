<?xml version="1.0" encoding="utf-8"?>
<odoo>
  <data>

      <!-- Requests for Quotation -->

      <!-- Create custom view for Requests for Quotation menu -->
      <record id="netping_purchase_order_kpis_tree" model="ir.ui.view">
          <field name="name">netping.purchase.order.inherit.purchase.order.tree</field>
          <field name="model">purchase.order</field>
          <field name="priority" eval="10"/>
          <field name="arch" type="xml">
              <tree string="Purchase Order" multi_edit="1" decoration-bf="message_unread==True"
                    class="o_purchase_order" js_class="purchase_list_dashboard" sample="1">
                  <header>
                      <button name="action_create_invoice" type="object" string="Create Bills"/>
                  </header>
                  <field name="priority" optional="hide" widget="priority" nolabel="1"/>
                  <field name="message_unread" invisible="1"/>
                  <field name="name" string="Reference" readonly="1" decoration-bf="1"/>
                  <field name="date_order" string="Order Date" optional="hide"/>
                  <field name="partner_id" readonly="1"/>
				  <field name="partner_ref"/>
				  <field name="date_planned" string="Scheduled Date"/>
                  <field name="company_id" groups="base.group_multi_company" options="{'no_create': True}" invisible="1"/>
                  <field name="user_id" widget="many2one_avatar_user" optional="hide"/>
                  <field name="origin" optional="hide"/>
                  <field name="amount_total" sum="Total amount" widget="monetary" string="Total" decoration-bf="1"/>
                  <field name="currency_id" invisible="1"/>
                  <field name="state" widget="badge" decoration-success="state == 'purchase' or state == 'done'"
                         decoration-warning="state == 'to approve'" decoration-info="state == 'draft' or state == 'sent'"/>
                  <field name="invoice_status" widget="badge"
                         decoration-success="invoice_status == 'invoiced'" decoration-info="invoice_status == 'to invoice'"
                         optional="hide"/>
              </tree>
          </field>
      </record>
	  
	  <!-- Override view_purchase_order_filter view for Requests for Quotation-->
      <record id="netping_view_purchase_order_filter" model="ir.ui.view">
          <field name="name">netping.view.purchase.order.filter</field>
          <field name="model">purchase.order</field>
          <field name="inherit_id" ref="purchase.view_purchase_order_filter"/>
          <field name="arch" type="xml">
			  <xpath expr="//group//filter[@name='order_date']" position="after">
                  <filter name="date_planned" string="Scheduled Date" domain="[]" context="{'group_by': 'date_planned'}"/>
				  <separator/>
              </xpath>
          </field>
      </record>

      <!-- Override purchase_rfq action for Requests for Quotation menu-->
      <record id="purchase.purchase_rfq" model="ir.actions.act_window">
          <field name="name">Requests for Quotation</field>
          <field name="type">ir.actions.act_window</field>
          <field name="res_model">purchase.order</field>
          <field name="view_mode">tree,kanban,form,pivot,graph,calendar,activity</field>
          <field name="view_id" ref="netping_purchase_order_kpis_tree"/>
          <field name="domain">[('state','in', ('draft', 'sent', 'to approve', 'cancel'))]</field>
          <field name="search_view_id" ref="purchase.view_purchase_order_filter"/>
          <field name="context">{'quotation_only': True}</field>
          <field name="help" type="html">
              <p class="o_view_nocontent_smiling_face">
                  No request for quotation found. Let's create one!
              </p>
              <p>
                  Requests for quotation are documents that will be sent to your suppliers to request prices for different products you consider buying.
                  Once an agreement has been found with the supplier, they will be confirmed and turned into purchase orders.
              </p>
          </field>
      </record>
	  
      <!-- Override menu_purchase_rfq menu for Requests for Quotation menu -->
      <record model="ir.ui.menu" id="purchase.menu_purchase_rfq">
        <field name="sequence" eval="1"/>
      </record>


      <!-- Purchase Orders -->

      <!-- Create custom view for Purchase Orders menu -->
      <record id="netping_purchase_order_view_tree" model="ir.ui.view">
          <field name="name">netping.purchase.order.view.tree</field>
          <field name="model">purchase.order</field>
          <field name="arch" type="xml">
              <tree decoration-bf="message_unread==True" decoration-muted="state=='cancel'" decoration-info="state in ('wait','confirmed')" string="Purchase Order" class="o_purchase_order" sample="1">
                  <header>
                      <button name="action_create_invoice" type="object" string="Create Bills"/>
                  </header>
                  <field name="priority" optional="hide" widget="priority" nolabel="1"/>
                  <field name="message_unread" invisible="1"/>
                  <field name="name" string="Reference" readonly="1" decoration-bf="1"/>
                  <field name="date_order" string="Order Date" optional="hide"/>
                  <field name="partner_id"/>
				  <field name="partner_ref"/>
                  <field name="date_planned" string="Scheduled Date"/>
                  <field name="company_id" groups="base.group_multi_company" options="{'no_create': True}" invisible="1"/>
                  <field name="user_id" widget="many2one_avatar_user" optional="hide"/>
                  <field name="origin" optional="hide"/>
                  <field name="amount_total" sum="Total amount" widget="monetary" decoration-bf="1" string="Total"/>
                  <field name="currency_id" invisible="1"/>
                  <field name="state" widget="badge" decoration-success="state == 'purchase' or state == 'done'"
                         decoration-warning="state == 'to approve'" decoration-info="state == 'draft' or state == 'sent'"/>
                  <field name="invoice_status" widget="badge" decoration-success="invoice_status == 'invoiced'"
                         decoration-info="invoice_status == 'to invoice'" optional="hide"/>
              </tree>
          </field>
      </record>
	  
	  <!-- Override purchase_order_view_search view for Purchase Orders-->
      <record id="netping_purchase_order_view_search" model="ir.ui.view">
          <field name="name">netping.purchase.order.view.search</field>
          <field name="model">purchase.order</field>
          <field name="inherit_id" ref="purchase.purchase_order_view_search"/>
          <field name="arch" type="xml">
              <xpath expr="//filter[@name='my_Orders']" position="before">
                  <filter name="active_purchases" string="Active Purchases" domain="[('state', '=', 'purchase')]"/>
				  <separator/>
              </xpath>
			  <xpath expr="//group//filter[@name='order_date']" position="after">
                  <filter name="date_planned" string="Scheduled Date" domain="[]" context="{'group_by': 'date_planned'}"/>
				  <separator/>
              </xpath>
          </field>
      </record>

      <!-- Override purchase_form_action action for Purchase Orders menu -->
      <record id="purchase.purchase_form_action" model="ir.actions.act_window">
          <field name="name">Purchase Orders</field>
          <field name="type">ir.actions.act_window</field>
          <field name="res_model">purchase.order</field>
          <field name="view_mode">tree,kanban,form,pivot,graph,calendar,activity</field>
          <field name="view_id" ref="netping_purchase_order_view_tree"/>
          <field name="domain">[('state','in',('purchase', 'done', 'cancel'))]</field>
          <field name="search_view_id" ref="purchase.purchase_order_view_search"/>
          <field name="context">{'search_default_active_purchases': 1}</field>
          <field name="help" type="html">
              <p class="o_view_nocontent_smiling_face">
                  No purchase order found. Let's create one!
              </p>
              <p>
                  Once you ordered your products to your supplier, confirm your request for quotation and it will turn into a purchase order.
              </p>
          </field>
      </record>
	  
      <!-- Override menu_purchase_form_action menu for Purchase Orders menu -->
      <record model="ir.ui.menu" id="purchase.menu_purchase_form_action">
        <field name="sequence" eval="0"/>
      </record>

      <!-- Update purchase orders form -->
      <record model="ir.ui.view" id="netping_purchase_order_form">
          <field name="name">netping.purchase.order.form</field>
          <field name="model">purchase.order</field>
          <field name="inherit_id" ref="purchase.purchase_order_form"/>
          <field name="arch" type="xml">
              <data>
                  <xpath expr="//button[@name='action_rfq_send' and @states='purchase']" position="attributes">
                      <attribute name='invisible'>1</attribute>
                  </xpath>
                  <xpath expr="//button[@name='confirm_reminder_mail']" position="attributes">
                      <attribute name='invisible'>1</attribute>
                  </xpath>
                  <xpath expr="//button[@name='action_create_invoice'][1]" position="attributes">
                      <attribute name='invisible'>1</attribute>
                  </xpath>
                  <xpath expr="//button[@name='action_create_invoice'][2]" position="attributes">
                      <attribute name='invisible'>1</attribute>
                  </xpath>
                  <xpath expr="//button[@name='button_done']" position="attributes">
                      <attribute name='string'>SET TO DONE</attribute>
                  </xpath>
                  <label for="date_approve" position="replace"></label>
                  <div name="date_approve" position="replace"></div>
                  <xpath expr="//field[@name='date_order']" position="attributes">
                      <attribute name='attrs'>{'invisible': [('state', '=', False)]}</attribute>
                      <attribute name='string'>Order Date</attribute>
                  </xpath>
                  <label for="date_planned" position="replace">
                      <label for="date_planned" string="Scheduled Date"></label>
                  </label>
              </data>
          </field>
      </record>
	  
	
	<!-- Products -->
	
	<!-- Override product_normal_action_puchased action for Products menu -->
	<record id="purchase.product_normal_action_puchased" model="ir.actions.act_window">
        <field name="name">Products</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">product.template</field>
        <field name="view_mode">tree,kanban,form,activity</field>
        <field name="context">{"search_default_filter_to_purchase":1, "purchase_product_template": 1}</field>
        <field name="search_view_id" ref="product.product_template_search_view"/>
        <field name="view_id" eval="False"/> <!-- Force empty -->
        <field name="help" type="html">
          <p class="o_view_nocontent_smiling_face">
            No product found. Let's create one!
          </p><p>
            You must define a product for everything you sell or purchase,
            whether it's a storable product, a consumable or a service.
          </p>
        </field>
    </record>
	
	
    <!-- Add SET TO DONE action menu for Purchase Order -->
    <record model="ir.actions.server" id="action_poe_set_to_done">
        <field name="name">Set to Done</field>
        <field name="model_id" ref="Odoo_Netping_Purchases.model_purchase_order"/>
        <field name="binding_model_id" ref="Odoo_Netping_Purchases.model_purchase_order"/>
        <field name="state">code</field>
        <field name="code">
            action = records.action_poe_set_to_done()
        </field>
    </record>
    
  </data>
</odoo>