<?xml version="1.0" encoding="utf-8"?>
<odoo>
  <data>

    <!-- Manufacturing Orders -->

    <!-- create custom view for Manufacturing Orders menu -->
    <record id="netping_mrp_production_tree_view" model="ir.ui.view">
        <field name="name">netping.mrp.production.tree.view</field>
        <field name="model">mrp.production</field>
        <field name="arch" type="xml">
            <tree string="Manufacturing Orders" default_order="priority desc, date_planned_start desc" multi_edit="1" sample="1">
                <header>
                    <button name="button_plan" type="object" string="Plan"/>
                    <button name="do_unreserve" type="object" string="Unreserve"/>
                </header>
                <field name="message_needaction" invisible="1"/>
                <field name="name" decoration-bf="1"/>
                <field name="date_planned_start" readonly="1"/>
                <field name="date_deadline" widget="remaining_days" attrs="{'invisible': [('state', 'in', ['done', 'cancel'])]}" optional="hide"/>
                <field name="product_id" readonly="1"/>
                <field name="product_qty" sum="Total Qty" string="Product Quantity" readonly="1"/>
                <field name="priority"/>
                <field name="origin" string="Source Document"/>
                <field name="user_id" invisible="1" widget="many2one_avatar_user"/>
                <field name="company_id" readonly="1" groups="base.group_multi_company" invisible="1"/>
                <field name="state" string="Status" widget='badge' decoration-success="state == 'done'" decoration-info="state not in ('done', 'cancel')"/>
                <field name="delay_alert_date" invisible="1"/>
            </tree>
        </field>
    </record>

    <!-- Override mrp_production_action action for Manufacturing Orders menu -->
    <record id="mrp.mrp_production_action" model="ir.actions.act_window">
        <field name="name">Manufacturing Orders</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">mrp.production</field>
        <field name="view_mode">tree,kanban,form,calendar,pivot,graph</field>
        <field name="view_id" eval="netping_mrp_production_tree_view"/>
        <field name="search_view_id" ref="mrp.view_mrp_production_filter"/>
        <field name="context">{'search_default_todo': True, 'default_company_id': allowed_company_ids[0]}</field>
        <field name="domain">[('picking_type_id.active', '=', True)]</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                No manufacturing order found. Let's create one.
            </p>
            <p>
                Consume <a name="%(product.product_template_action)d" type='action' tabindex="-1">components</a> and build finished products using <a name="%(mrp.mrp_bom_form_action)d" type='action' tabindex="-1">bills of materials</a>
            </p>
        </field>
    </record>

    <!-- Bills of Materials -->

    <!-- create custom view for Bills of Materials menu -->
    <record id="netping_mrp_bom_tree_view" model="ir.ui.view">
        <field name="name">netping.mrp.bom.tree</field>
        <field name="model">mrp.bom</field>
        <field name="arch" type="xml">
            <tree string="Bill of Materials" sample="1">
                <field name="active" invisible="1"/>
                <field name="sequence" invisible="1"/>
                <field name="product_tmpl_id"/>
                <field name="code"/>
                <field name="type" invisible="1"/>
                <field name="product_id" groups="product.group_product_variant" invisible="1"/>
                <field name="company_id" groups="base.group_multi_company" invisible="1"/>
                <field name="product_qty" optional="hide"/>
                <field name="product_uom_id" groups="uom.group_uom" invisible="1" string="Unit of Measure"/>
            </tree>
        </field>
    </record>

    <!-- Override action_move_out_invoice_type action for Customers Invoices menu -->
    <record id="mrp.mrp_bom_form_action" model="ir.actions.act_window">
        <field name="name">Bills of Materials</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">mrp.bom</field>
        <field name="domain">[]</field> <!-- force empty -->
        <field name="view_mode">tree,kanban,form</field>
        <field name="view_id" ref="netping_mrp_bom_tree_view"/>
        <field name="search_view_id" ref="mrp.view_mrp_bom_filter"/>
        <field name="context">{'default_company_id': allowed_company_ids[0]}</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                No bill of materials found. Let's create one!
            </p>
            <p>
                Bills of materials allow you to define the list of required raw
                materials used to make a finished product; through a manufacturing
                order or a pack of products.
            </p>
        </field>
    </record>
	
	<!-- Update Bill of Materials form -->
    <record model="ir.ui.view" id="netping_mrp_bom_form_view">
        <field name="name">netping.mrp.bom.form.view</field>
        <field name="model">mrp.bom</field>
        <field name="inherit_id" ref="mrp.mrp_bom_form_view"/>
        <field name="arch" type="xml">
            <data>
                <xpath expr="//field[@name='bom_line_ids']/tree/field[@name='product_qty']" position="after">
                    <field name="x_positions"/>
                </xpath>
            </data>
        </field>
    </record>
    
  </data>
</odoo>